<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 解读Java关键字final · Mi Tang</title><meta name="description" content="解读Java关键字final - fish·nut"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://lpbobo.com/atom.xml" title="Mi Tang"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">HOME</a></li><li class="nav-list-item"><a href="/categories/Science" target="_self" class="nav-list-link">SCIENCE</a></li><li class="nav-list-item"><a href="/categories/Trip" target="_self" class="nav-list-link">TRIP</a></li><li class="nav-list-item"><a href="/About" target="_self" class="nav-list-link">WE</a></li></ul></header><div class="wrap"><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">解读Java关键字final</h1><div class="post-info">2016年4月30日</div><div class="post-content"><p>在Java中通过final关键字来声明对象具有不变性(immutable)，这里的对象包括变量，方法，类，与C++中的const关键字效果类似。</p>
<a id="more"></a>
<blockquote>
<p>immutable指对象在创建之后，状态无法被改变</p>
</blockquote>
<p>可以从三个角度考虑使用final关键字：</p>
<ol>
<li>代码本身：不希望final描述的对象所表现的含义被改变</li>
<li>安全：final对象具有只读属性，是线程安全的</li>
<li>效率：无法修改final对象本身，对其引用的操作更为高效</li>
</ol>
<h3 id="final-变量"><a href="#final-变量" class="headerlink" title="final 变量"></a>final 变量</h3><p>定义<code>final Object a</code>，则a只能被初始化一次，一旦初始化，a的数据无法修改，若a为引用类型，则不能重新绑定其他对象。<br>未被初始化的final变量被称为blank final，若为成员变量，则必须被初始化或在构造器中赋值。</p>
<p>例子：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span> </span>&#123;</div><div class="line">	<span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">double</span> PI = <span class="number">3.1415926</span>;</div><div class="line">	<span class="keyword">final</span> <span class="keyword">int</span> radius = <span class="number">5</span>;</div><div class="line">	<span class="keyword">final</span> <span class="keyword">int</span> xPos;</div><div class="line">	<span class="keyword">final</span> <span class="keyword">int</span> yPos;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Circle</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</div><div class="line">		xPos = x; </div><div class="line">		yPos = y;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="final-方法"><a href="#final-方法" class="headerlink" title="final 方法"></a>final 方法</h3><p>定义<code>final method</code>，则该方法无法被重载，方法设计者不希望由于对方法的重载导致其他相关功能出现异常。</p>
<p>例子：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseClass</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">DerivedClass</span> <span class="keyword">extends</span> <span class="title">BaseClass</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span> </span>&#123;&#125; <span class="comment">// 编译出错</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>需要注意的是，final方法的定义不一定能够产生inline的效果，因为方法是否inline取决于JVM的策略，而非final关键字，通过final的设计提高方法效率是不准确的。</p>
<h3 id="final-类"><a href="#final-类" class="headerlink" title="final 类"></a>final 类</h3><p><code>final class X</code>定义的类X无法被继承。</p>
<p>在Java中，String类被设计成final，其定义如下</p>
<pre><code>public class final String extends Object  implements Serializable, Comparable&lt;String&gt;, CharSequence
</code></pre><p>为什么String被设计成final？</p>
<ol>
<li>一个String类的实例被初始化后，其在堆上的内容无法被改变，String类提供的任何修改String对象的方法都只能够产生一个新的String对象，大大简化了对String的操作，是代码更易于阅读和理解；</li>
<li>String final是实现String interning（在内存中不同的string值只有一份）的必要条件，因为通常代码中存在大量的String对象，不同的引用会指向相同的字符串空间，若String不为final，则当一个字符串空间的内容改变时，所有的引用都需要知道这一情况，这一机制的实现是十分复杂的，无疑会影响效率。String interning能够节省内存空间，同时也节省时间花销；</li>
<li>String只读，则不必担心非常重要的内容被篡改；</li>
</ol>
<h3 id="内部类与final"><a href="#内部类与final" class="headerlink" title="内部类与final"></a>内部类与final</h3><p>在一个方法内定义匿名内部类时，内部类只能访问方法内的final类型变量，使得Java编译器能够提前捕获变量的值，并在内部类保存一份副本，当方法销毁时，内部类的内存空间依然完整。</p>
<p>例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Wrapper</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">      </div><div class="line">       	<span class="comment">// Object obj = null; //编译出错</span></div><div class="line">       	<span class="keyword">final</span> Object obj = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">        	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        		obj = <span class="string">"hello"</span>;</div><div class="line">        	&#125;</div><div class="line">        &#125;).start();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li>Wiki: <a href="https://en.wikipedia.org/wiki/Final_(Java)#cite_note-3" target="_blank" rel="external">https://en.wikipedia.org/wiki/Final_(Java)#cite_note-3</a></li>
<li><a href="https://en.wikipedia.org/wiki/Immutable_object#Java" target="_blank" rel="external">Wiki: immutable</a></li>
<li><a href="http://mindprod.com/jgloss/immutable.html" target="_blank" rel="external">Immutable: Java Glossary</a></li>
</ol>
</div></article></div></section><footer><div class="paginator"><a href="/2016/05/06/别学了，开始做吧/" class="prev">上一篇</a><a href="/2016/04/30/深入浅出区块链/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2016 <a href="http://lpbobo.com">fish·nut</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p><p><span>友情链接</span>&#58;&nbsp;&nbsp;&nbsp;&nbsp;&bull;&nbsp;<a href="http://blog.csdn.net/sum__mer">sum__mer </a>&nbsp;&nbsp;&nbsp;&nbsp;&bull;&nbsp;<a href="http://www.rudy-yuan.net">rudy-yuan </a>&nbsp;&nbsp;&nbsp;&nbsp;&bull;&nbsp;<a href="http://elvin.im">花花世界 </a></p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>